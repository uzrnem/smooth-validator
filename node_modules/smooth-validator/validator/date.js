const dataType = require('../dataType');
const helper = require('../helper');

module.exports = {
  validateDate: function (varName, varValue) {
    if (!dataType.isDate(varValue))
      return { variable: varName, name: varName, value: varValue, first_value: varValue };
    return null;
  },
  validateDateComparison: function (type, varName, varValue, values, dataObj) {
    var compareTo = values[0]
    if (values[0] in dataObj) {
      compareTo = new Date(dataObj[values[0]]);
    } else if (compareTo == "today") {
      compareTo = new Date()
    } else if (compareTo == "yesterday") {
      compareTo = new Date()
      compareTo.setDate(compareTo.getDate() - 1);
    } else if (compareTo == "tomorrow") {
      compareTo = new Date()
      compareTo.setDate(compareTo.getDate() + 1);
    } else {
      compareTo = new Date(compareTo)
    }
    var actualDate = varValue;
    if ((actualDate instanceof Date) == false) {
      actualDate = new Date(varValue);
    }
    if (
      (type == 'after' && helper.removeTime(actualDate) <= helper.removeTime(compareTo) ) ||
      (type == 'after_or_equals' && helper.removeTime(actualDate) < helper.removeTime(compareTo) ) ||
      (type == 'before' && helper.removeTime(actualDate) >= helper.removeTime(compareTo) ) ||
      (type == 'before_or_equals' && helper.removeTime(actualDate) > helper.removeTime(compareTo) )
    ) 
      return { variable: varName, name: varName, value: varValue, first_value: values[0] };
    return null;
  }
}